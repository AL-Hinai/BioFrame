# Phylogenomics Phylogenetic Analysis Pipeline
# Based on PhylogenomicsPipelines make_species_trees_pipeline.sh

workflow_name: "Phylogenomics Phylogenetic Analysis Pipeline"
workflow_description: "Construct species trees from recovered genes using multiple phylogenetic methods"
workflow_version: "1.0"
workflow_author: "BioFrame Team"
workflow_category: "Phylogenetic Analysis"

# Pipeline steps
steps:
  - step_number: 1
    step_name: "Sequence Alignment"
    tool_name: "mafft"
    description: "Multiple sequence alignment of gene sequences"
    input_types: ["FASTA"]
    output_types: ["FASTA", "ALN"]
    parameters:
      algorithm: "auto"
      output_format: "fasta"
      threads: 4
      options: ["--auto", "--reorder"]

  - step_number: 2
    step_name: "Alignment Trimming"
    tool_name: "trimal"
    description: "Trim multiple sequence alignments to remove poorly aligned regions"
    input_types: ["FASTA", "ALN"]
    output_types: ["FASTA"]
    parameters:
      method: "automated1"
      gap_threshold: 0.1
      similarity_threshold: 0.1

  - step_number: 3
    step_name: "Gene Tree Construction - IQ-TREE"
    tool_name: "iqtree"
    description: "Build individual gene trees using IQ-TREE with model selection"
    input_types: ["FASTA"]
    output_types: ["NEWICK", "LOG"]
    parameters:
      model: "MFP"
      bootstrap: 1000
      threads: 4
      options: ["-bb", "1000", "-nt", "4"]

  - step_number: 4
    step_name: "Gene Tree Construction - RAxML (Alternative)"
    tool_name: "raxml"
    description: "Build gene trees using RAxML for comparison"
    input_types: ["FASTA"]
    output_types: ["NEWICK", "LOG"]
    parameters:
      model: "GTRGAMMA"
      bootstrap: 100
      threads: 4
      options: ["-f", "a", "-x", "12345", "-p", "12345", "-N", "100"]

  - step_number: 5
    step_name: "Species Tree Construction - ASTRAL"
    tool_name: "astral"
    description: "Construct species tree from individual gene trees using ASTRAL"
    input_types: ["NEWICK"]
    output_types: ["NEWICK", "LOG"]
    parameters:
      method: "astral"
      bootstrap: 100
      options: ["-i", "gene_trees.nwk", "-o", "species_tree.nwk"]

  - step_number: 6
    step_name: "Species Tree Construction - Concatenated"
    tool_name: "iqtree"
    description: "Build species tree from concatenated gene alignments"
    input_types: ["FASTA"]
    output_types: ["NEWICK", "LOG"]
    parameters:
      model: "MFP"
      bootstrap: 1000
      threads: 4
      options: ["-bb", "1000", "-nt", "4", "-s", "concatenated_alignment.fasta"]

  - step_number: 7
    step_name: "Tree Visualization"
    tool_name: "tree_visualizer"
    description: "Generate tree visualization and summary statistics"
    input_types: ["NEWICK"]
    output_types: ["PDF", "SVG", "HTML"]
    parameters:
      format: "pdf"
      include_bootstrap: true
      include_support: true

# Workflow configuration
workflow_config:
  parallel_execution: true
  error_handling: "continue_on_error"
  resource_requirements:
    memory: "16GB"
    cpu_cores: 8
    storage: "50GB"
  
  # Input validation
  input_validation:
    required_formats: ["FASTA"]
    min_sequences: 3
    max_sequences: 10000
  
  # Output configuration
  output_config:
    create_summary: true
    generate_reports: true
    compress_outputs: true
    include_alignments: true
    include_trees: true

# Tool dependencies
dependencies:
  - name: "mafft"
    version: "7.505"
    required: true
  - name: "iqtree"
    version: "2.2.0"
    required: true
  - name: "raxml"
    version: "8.2.12"
    required: false
  - name: "astral"
    version: "5.7.8"
    required: true
  - name: "fasttree"
    version: "2.1.11"
    required: false

# Advanced options
advanced_options:
  tree_optimization:
    treeshrink: true
    bootstrap_threshold: 15
    long_branch_detection: true
  
  alignment_quality:
    coverage_filtering: true
    min_coverage: 60
    rare_insertion_removal: true
    insertion_threshold: 0.003
  
  species_tree_methods:
    - "astral"
    - "concatenated_iqtree"
    - "concatenated_raxml"
    - "fasttree"

# Example usage
example_usage:
  command: "python manage.py run_workflow phylogenetic_analysis_pipeline --input genes/*.fasta --output results/"
  description: "Run phylogenetic analysis on all gene files in genes directory"
